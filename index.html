<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2P オセロ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-template-rows: repeat(8, 50px);
      gap: 2px;
      margin: 20px auto;
      width: max-content;
    }
    .cell {
      width: 50px;
      height: 50px;
      background-color: green;
      border: 1px solid black;
      position: relative;
      cursor: pointer;
    }
    .disk {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      position: absolute;
      top: 5px;
      left: 5px;
    }
    .black {
      background-color: black;
    }
    .white {
      background-color: white;
    }
    #turn {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>2人用オセロ</h1>
<div id="turn">黒の番です</div>
<div id="board"></div>

<script>
  const board = document.getElementById("board");
  const turnText = document.getElementById("turn");
  const SIZE = 8;
  const EMPTY = 0, BLACK = 1, WHITE = 2;
  let currentPlayer = BLACK;

  let cells = Array(SIZE).fill().map(() => Array(SIZE).fill(EMPTY));

  // 初期配置
  cells[3][3] = WHITE;
  cells[3][4] = BLACK;
  cells[4][3] = BLACK;
  cells[4][4] = WHITE;

  const directions = [
    [-1, -1], [-1, 0], [-1, 1],
    [0, -1],          [0, 1],
    [1, -1], [1, 0], [1, 1],
  ];

  function render() {
    board.innerHTML = "";
    for (let y = 0; y < SIZE; y++) {
      for (let x = 0; x < SIZE; x++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        if (cells[y][x] === BLACK || cells[y][x] === WHITE) {
          const disk = document.createElement("div");
          disk.className = "disk " + (cells[y][x] === BLACK ? "black" : "white");
          cell.appendChild(disk);
        }
        cell.addEventListener("click", () => handleClick(x, y));
        board.appendChild(cell);
      }
    }
  }

  function isValidMove(x, y, player) {
    if (cells[y][x] !== EMPTY) return false;
    const opponent = player === BLACK ? WHITE : BLACK;
    for (const [dx, dy] of directions) {
      let nx = x + dx, ny = y + dy;
      let hasOpponentBetween = false;
      while (nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE && cells[ny][nx] === opponent) {
        nx += dx;
        ny += dy;
        hasOpponentBetween = true;
      }
      if (hasOpponentBetween && nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE && cells[ny][nx] === player) {
        return true;
      }
    }
    return false;
  }

  function handleClick(x, y) {
    if (!isValidMove(x, y, currentPlayer)) return;

    cells[y][x] = currentPlayer;
    const opponent = currentPlayer === BLACK ? WHITE : BLACK;

    for (const [dx, dy] of directions) {
      let nx = x + dx, ny = y + dy;
      const toFlip = [];
      while (nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE && cells[ny][nx] === opponent) {
        toFlip.push([nx, ny]);
        nx += dx;
        ny += dy;
      }
      if (toFlip.length > 0 && nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE && cells[ny][nx] === currentPlayer) {
        toFlip.forEach(([fx, fy]) => {
          cells[fy][fx] = currentPlayer;
        });
      }
    }

    currentPlayer = currentPlayer === BLACK ? WHITE : BLACK;
    turnText.textContent = currentPlayer === BLACK ? "黒の番です" : "白の番です";

    render();
  }

  render();
</script>

</body>
</html>
